<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Life</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <link rel="icon" type="image/png" href="./imeges/Life Logo.png">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800&family=Kalam:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Montserrat', sans-serif;
            background: linear-gradient(135deg, #F3E9E9 0%, #E8D5E8 100%);
            min-height: 100vh;
        }
        
        .font-handwriting {
            font-family: 'Kalam', cursive;
        }
        

        .glass {
            background: rgba(255, 255, 255, 0.25);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.18);
        }
        

        .stat-card {
            background: rgba(255, 255, 255, 0.3);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        

        .admin-table {
            background: rgba(255, 255, 255, 0.4);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .table-header {
            background: rgba(169, 78, 189, 0.1);
            border-bottom: 2px solid rgba(169, 78, 189, 0.2);
        }
        
        .table-row {
            border-bottom: 1px solid rgba(169, 78, 189, 0.1);
            transition: all 0.2s ease;
        }
        
        .table-row:hover {
            background: rgba(169, 78, 189, 0.05);
        }
        

        .loading-spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #A94EBD;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        

        .status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .status-active {
            background: rgba(76, 175, 80, 0.2);
            color: #2E7D32;
        }
        
        .status-inactive {
            background: rgba(255, 152, 0, 0.2);
            color: #F57C00;
        }
        

        .modal {
            transition: opacity 0.3s ease, visibility 0.3s ease;
            backdrop-filter: blur(5px);
        }
        

        .search-box {
            background: rgba(255, 255, 255, 0.3);
            border: 2px solid rgba(169, 78, 189, 0.2);
            transition: all 0.3s ease;
        }
        
        .search-box:focus {
            border-color: #A94EBD;
            box-shadow: 0 0 0 3px rgba(169, 78, 189, 0.1);
        }
        

        .mobile-menu-button {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.2);
            color: #4B2E5E;
            cursor: pointer;
            transition: all 0.2s ease;
            border: none;
        }

        .mobile-menu-button:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .mobile-menu {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 50;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }

        .mobile-menu.active {
            opacity: 1;
            visibility: visible;
        }

        .mobile-menu-content {
            position: absolute;
            top: 0;
            right: -300px;
            width: 280px;
            height: 100%;
            background: linear-gradient(135deg, #F3E9E9 0%, #E8D5E8 100%);
            padding: 24px;
            transition: right 0.3s ease;
            overflow-y: auto;
            box-shadow: -5px 0 15px rgba(0, 0, 0, 0.1);
        }

        .mobile-menu.active .mobile-menu-content {
            right: 0;
        }

        .mobile-menu-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 1px solid rgba(75, 46, 94, 0.2);
        }

        .mobile-menu-close {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #4B2E5E;
            cursor: pointer;
            transition: all 0.2s ease;
            border: none;
        }

        .mobile-menu-close:hover {
            background: rgba(255, 255, 255, 0.4);
        }

        .mobile-nav-links {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .mobile-nav-link {
            padding: 16px;
            border-radius: 12px;
            color: #4B2E5E;
            font-weight: 600;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            text-decoration: none;
            font-size: 14px;
            letter-spacing: 0.5px;
        }

        .mobile-nav-link i {
            margin-right: 12px;
            width: 20px;
            text-align: center;
            font-size: 16px;
        }

        .mobile-nav-link:hover {
            background: rgba(255, 255, 255, 0.3);
            color: #A94EBD;
            transform: translateX(4px);
        }

        .mobile-nav-link.active {
            background: rgba(255, 255, 255, 0.4);
            color: #A94EBD;
        }
        

        @media (max-width: 768px) {
            .admin-table {
                font-size: 14px;
            }
            
            .stat-card {
                padding: 1rem;
            }
            
            .table-responsive {
                overflow-x: auto;
            }
        }

        .chart-container {
            background: rgba(255, 255, 255, 0.3);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 16px;
            padding: 24px;
        }

        /* Added styles for analytics section */
        .analytics-section {
            display: none;
        }
        
        .analytics-section.active {
            display: block;
        }
        
        .chart-wrapper {
            position: relative;
            height: 300px;
        }
        
        .chart-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: #4B2E5E;
            margin-bottom: 1rem;
            text-align: center;
        }
    </style>
</head>
<body>
    <!-- Mobile Menu -->
    <div id="mobile-menu" class="mobile-menu">
        <div class="mobile-menu-content">
            <div class="mobile-menu-header">
                <h3 class="text-lg font-bold text-[#4B2E5E]">Admin Menu</h3>
                <button id="mobile-menu-close" class="mobile-menu-close">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <nav class="mobile-nav-links">
                <a href="#" class="mobile-nav-link active" data-section="dashboard">
                    <i class="fas fa-tachometer-alt"></i>Dashboard
                </a>
                <a href="#" class="mobile-nav-link" data-section="analytics">
                    <i class="fas fa-chart-bar"></i>Analytics
                </a>
                <!-- Added review management link to mobile menu -->
                <a href="#" class="mobile-nav-link" data-section="reviews">
                    <i class="fas fa-star"></i>Review Management
                </a>
            </nav>
        </div>
    </div>

    <div class="min-h-screen p-4 md:p-8">
        <!-- Header -->
        <div class="glass rounded-2xl p-6 mb-8">
            <div class="flex flex-col md:flex-row md:items-center md:justify-between">
                <div class="flex items-center space-x-4 mb-4 md:mb-0">
                    <div class="bg-gradient-to-br from-[#A94EBD] to-[#4B2E5E] rounded-full w-12 h-12 flex items-center justify-center">
                        <i class="fas fa-user-shield text-white text-xl"></i>
                    </div>
                    <div>
                        <h1 class="text-2xl md:text-3xl font-bold text-[#4B2E5E] font-handwriting">Admin Dashboard</h1>
                        <p class="text-[#4B2E5E] opacity-70">Manage your Life application</p>
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <!-- Desktop Navigation -->
                    <nav class="hidden md:flex space-x-2">
                        <button class="nav-btn active" data-section="dashboard">
                            <i class="fas fa-tachometer-alt mr-2"></i>Dashboard
                        </button>
                        <button class="nav-btn" data-section="analytics">
                            <i class="fas fa-chart-bar mr-2"></i>Analytics
                        </button>
                        <!-- Added review management button to desktop navigation -->
                        <button class="nav-btn" data-section="reviews">
                            <i class="fas fa-star mr-2"></i>Reviews
                        </button>
                    </nav>
                    
                    <!-- Mobile Menu Button -->
                    <button id="mobile-menu-button" class="mobile-menu-button md:hidden">
                        <i class="fas fa-bars"></i>
                    </button>
                    
                    <button onclick="auth.signOut()" class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition-colors">
                        <i class="fas fa-sign-out-alt mr-2"></i>
                        <span class="hidden sm:inline">Sign Out</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Dashboard Section -->
        <div id="dashboard-section" class="section active">
            <!-- Statistics Cards -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <div class="stat-card rounded-2xl p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-[#4B2E5E] opacity-70 text-sm font-medium">Total Users</p>
                            <p id="total-users" class="text-2xl font-bold text-[#4B2E5E]">0</p>
                        </div>
                        <div class="bg-gradient-to-br from-[#A94EBD] to-[#4B2E5E] rounded-full w-12 h-12 flex items-center justify-center">
                            <i class="fas fa-users text-white"></i>
                        </div>
                    </div>
                </div>
                
                <div class="stat-card rounded-2xl p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-[#4B2E5E] opacity-70 text-sm font-medium">Active Users</p>
                            <p id="active-users" class="text-2xl font-bold text-[#4B2E5E]">0</p>
                        </div>
                        <div class="bg-gradient-to-br from-green-400 to-green-600 rounded-full w-12 h-12 flex items-center justify-center">
                            <i class="fas fa-user-check text-white"></i>
                        </div>
                    </div>
                </div>
                
                <div class="stat-card rounded-2xl p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-[#4B2E5E] opacity-70 text-sm font-medium">New This Month</p>
                            <p id="new-users" class="text-2xl font-bold text-[#4B2E5E]">0</p>
                        </div>
                        <div class="bg-gradient-to-br from-blue-400 to-blue-600 rounded-full w-12 h-12 flex items-center justify-center">
                            <i class="fas fa-user-plus text-white"></i>
                        </div>
                    </div>
                </div>
                
                <div class="stat-card rounded-2xl p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-[#4B2E5E] opacity-70 text-sm font-medium">Profile Complete</p>
                            <p id="complete-profiles" class="text-2xl font-bold text-[#4B2E5E]">0</p>
                        </div>
                        <div class="bg-gradient-to-br from-orange-400 to-orange-600 rounded-full w-12 h-12 flex items-center justify-center">
                            <i class="fas fa-user-edit text-white"></i>
                        </div>
                    </div>
                </div>
            </div>

            <!-- User Management -->
            <div class="admin-table rounded-2xl overflow-hidden">
                <div class="p-6 border-b border-white border-opacity-20">
                    <div class="flex flex-col md:flex-row md:items-center md:justify-between space-y-4 md:space-y-0">
                        <h2 class="text-xl font-bold text-[#4B2E5E]">User Management</h2>
                        <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-4">
                            <input type="text" id="search-users" placeholder="Search users..." 
                                   class="search-box rounded-lg px-4 py-2 text-[#4B2E5E] placeholder-[#4B2E5E] placeholder-opacity-50 outline-none">
                            <button onclick="loadUsers()" class="bg-gradient-to-r from-[#A94EBD] to-[#4B2E5E] text-white px-4 py-2 rounded-lg hover:shadow-lg transition-all">
                                <i class="fas fa-sync-alt mr-2"></i>Refresh
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Loading State -->
                <div id="loading-state" class="p-8 text-center">
                    <div class="loading-spinner mx-auto mb-4"></div>
                    <p class="text-[#4B2E5E] opacity-70">Loading users...</p>
                </div>
                
                <!-- Empty State -->
                <div id="empty-state" class="p-8 text-center hidden">
                    <i class="fas fa-users text-6xl text-[#4B2E5E] opacity-30 mb-4"></i>
                    <h3 class="text-xl font-bold text-[#4B2E5E] mb-2">No Users Found</h3>
                    <p class="text-[#4B2E5E] opacity-70">No users match your search criteria.</p>
                </div>
                
                <!-- Users Table -->
                <div class="table-responsive hidden">
                    <table class="w-full">
                        <thead class="table-header">
                            <tr>
                                <th class="p-4 text-left text-[#4B2E5E] font-semibold">User</th>
                                <th class="p-4 text-left text-[#4B2E5E] font-semibold hidden md:table-cell">Email</th>
                                <th class="p-4 text-left text-[#4B2E5E] font-semibold hidden lg:table-cell">Created</th>
                                <th class="p-4 text-left text-[#4B2E5E] font-semibold hidden lg:table-cell">Last Login</th>
                                <th class="p-4 text-left text-[#4B2E5E] font-semibold">Status</th>
                                <th class="p-4 text-left text-[#4B2E5E] font-semibold">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="users-table-body">
                            <!-- Users will be populated here -->
                        </tbody>
                    </table>
                </div>
                
                <!-- Pagination -->
                <div class="p-4 border-t border-white border-opacity-20 flex flex-col sm:flex-row sm:items-center sm:justify-between space-y-2 sm:space-y-0">
                    <p id="page-info" class="text-sm text-[#4B2E5E] opacity-70">Page 1 of 1</p>
                    <div class="flex space-x-2">
                        <button id="prev-page" class="px-3 py-1 bg-white bg-opacity-20 text-[#4B2E5E] rounded hover:bg-opacity-30 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                            <i class="fas fa-chevron-left"></i>
                        </button>
                        <button id="next-page" class="px-3 py-1 bg-white bg-opacity-20 text-[#4B2E5E] rounded hover:bg-opacity-30 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Analytics Section -->
        <div id="analytics-section" class="section analytics-section">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- User Activity Chart -->
                <div class="chart-container">
                    <h3 class="chart-title">User Activity Distribution</h3>
                    <div class="chart-wrapper">
                        <canvas id="userActivityChart"></canvas>
                    </div>
                </div>
                
                <!-- Profile Completion Chart -->
                <div class="chart-container">
                    <h3 class="chart-title">Profile Completion Status</h3>
                    <div class="chart-wrapper">
                        <canvas id="profileCompletionChart"></canvas>
                    </div>
                </div>
                
                <!-- User Registration Trends -->
                <div class="chart-container">
                    <h3 class="chart-title">User Registration Trends</h3>
                    <div class="chart-wrapper">
                        <canvas id="registrationTrendsChart"></canvas>
                    </div>
                </div>
                
                <!-- Daily Login Activity -->
                <div class="chart-container">
                    <h3 class="chart-title">Daily Login Activity</h3>
                    <div class="chart-wrapper">
                        <canvas id="loginActivityChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Added complete review management section -->
        <!-- Review Management Section -->
        <div id="reviews-section" class="section analytics-section">
            <div class="admin-table rounded-2xl overflow-hidden mb-8">
                <div class="p-6 border-b border-white border-opacity-20">
                    <div class="flex flex-col md:flex-row md:items-center md:justify-between space-y-4 md:space-y-0">
                        <h2 class="text-xl font-bold text-[#4B2E5E]">Review Management</h2>
                        <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-4">
                            <input type="text" id="search-reviews" placeholder="Search reviews..." 
                                   class="search-box rounded-lg px-4 py-2 text-[#4B2E5E] placeholder-[#4B2E5E] placeholder-opacity-50 outline-none">
                            <select id="filter-rating" class="search-box rounded-lg px-4 py-2 text-[#4B2E5E] outline-none">
                                <option value="">All Ratings</option>
                                <option value="5">5 Stars</option>
                                <option value="4">4 Stars</option>
                                <option value="3">3 Stars</option>
                                <option value="2">2 Stars</option>
                                <option value="1">1 Star</option>
                            </select>
                            <button onclick="loadReviews()" class="bg-gradient-to-r from-[#A94EBD] to-[#4B2E5E] text-white px-4 py-2 rounded-lg hover:shadow-lg transition-all">
                                <i class="fas fa-sync-alt mr-2"></i>Refresh
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Review Statistics -->
                <div class="p-6 border-b border-white border-opacity-20">
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                        <div class="text-center">
                            <p class="text-2xl font-bold text-[#4B2E5E]" id="total-reviews">0</p>
                            <p class="text-sm text-[#4B2E5E] opacity-70">Total Reviews</p>
                        </div>
                        <div class="text-center">
                            <p class="text-2xl font-bold text-[#4B2E5E]" id="average-rating">0.0</p>
                            <p class="text-sm text-[#4B2E5E] opacity-70">Average Rating</p>
                        </div>
                        <div class="text-center">
                            <p class="text-2xl font-bold text-[#4B2E5E]" id="five-star-reviews">0</p>
                            <p class="text-sm text-[#4B2E5E] opacity-70">5-Star Reviews</p>
                        </div>
                        <div class="text-center">
                            <p class="text-2xl font-bold text-[#4B2E5E]" id="recent-reviews">0</p>
                            <p class="text-sm text-[#4B2E5E] opacity-70">This Week</p>
                        </div>
                    </div>
                </div>
                
                <!-- Loading State for Reviews -->
                <div id="reviews-loading-state" class="p-8 text-center">
                    <div class="loading-spinner mx-auto mb-4"></div>
                    <p class="text-[#4B2E5E] opacity-70">Loading reviews...</p>
                </div>
                
                <!-- Empty State for Reviews -->
                <div id="reviews-empty-state" class="p-8 text-center hidden">
                    <i class="fas fa-star text-6xl text-[#4B2E5E] opacity-30 mb-4"></i>
                    <h3 class="text-xl font-bold text-[#4B2E5E] mb-2">No Reviews Found</h3>
                    <p class="text-[#4B2E5E] opacity-70">No reviews match your search criteria.</p>
                </div>
                
                <!-- Reviews Table -->
                <div id="reviews-table-container" class="table-responsive hidden">
                    <table class="w-full">
                        <thead class="table-header">
                            <tr>
                                <th class="p-4 text-left text-[#4B2E5E] font-semibold">User</th>
                                <th class="p-4 text-left text-[#4B2E5E] font-semibold">Rating</th>
                                <th class="p-4 text-left text-[#4B2E5E] font-semibold">Review</th>
                                <th class="p-4 text-left text-[#4B2E5E] font-semibold hidden md:table-cell">Date</th>
                                <th class="p-4 text-left text-[#4B2E5E] font-semibold">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="reviews-table-body">
                            <!-- Reviews will be populated here -->
                        </tbody>
                    </table>
                </div>
                
                <!-- Reviews Pagination -->
                <div class="p-4 border-t border-white border-opacity-20 flex flex-col sm:flex-row sm:items-center sm:justify-between space-y-2 sm:space-y-0">
                    <p id="reviews-page-info" class="text-sm text-[#4B2E5E] opacity-70">Page 1 of 1</p>
                    <div class="flex space-x-2">
                        <button id="reviews-prev-page" class="px-3 py-1 bg-white bg-opacity-20 text-[#4B2E5E] rounded hover:bg-opacity-30 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                            <i class="fas fa-chevron-left"></i>
                        </button>
                        <button id="reviews-next-page" class="px-3 py-1 bg-white bg-opacity-20 text-[#4B2E5E] rounded hover:bg-opacity-30 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- User Details Modal -->
    <div id="user-modal" class="modal fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 invisible opacity-0 z-50">
        <div class="glass rounded-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto">
            <div class="p-6 border-b border-white border-opacity-20 flex items-center justify-between">
                <h3 class="text-xl font-bold text-[#4B2E5E]">User Details</h3>
                <button onclick="closeModal()" class="text-[#4B2E5E] hover:text-[#A94EBD] transition-colors">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <div id="user-detail-content" class="p-6">
                <!-- User details will be populated here -->
            </div>
        </div>
    </div>

    <!-- Added review edit modal -->
    <!-- Review Edit Modal -->
    <div id="review-modal" class="modal fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 invisible opacity-0 z-50">
        <div class="glass rounded-2xl max-w-2xl w-full">
            <div class="p-6 border-b border-white border-opacity-20 flex items-center justify-between">
                <h3 class="text-xl font-bold text-[#4B2E5E]">Edit Review</h3>
                <button onclick="closeReviewModal()" class="text-[#4B2E5E] hover:text-[#A94EBD] transition-colors">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <div class="p-6">
                <form id="edit-review-form">
                    <input type="hidden" id="edit-review-id">
                    <div class="mb-4">
                        <label class="block text-[#4B2E5E] font-semibold mb-2">Rating</label>
                        <select id="edit-review-rating" class="w-full search-box rounded-lg px-4 py-2 text-[#4B2E5E] outline-none">
                            <option value="1">1 Star</option>
                            <option value="2">2 Stars</option>
                            <option value="3">3 Stars</option>
                            <option value="4">4 Stars</option>
                            <option value="5">5 Stars</option>
                        </select>
                    </div>
                    <div class="mb-6">
                        <label class="block text-[#4B2E5E] font-semibold mb-2">Review Text</label>
                        <textarea id="edit-review-text" rows="4" class="w-full search-box rounded-lg px-4 py-2 text-[#4B2E5E] outline-none resize-none" placeholder="Enter review text..."></textarea>
                    </div>
                    <div class="flex space-x-4">
                        <button type="submit" class="flex-1 bg-gradient-to-r from-[#A94EBD] to-[#4B2E5E] text-white px-6 py-2 rounded-lg hover:shadow-lg transition-all">
                            <i class="fas fa-save mr-2"></i>Save Changes
                        </button>
                        <button type="button" onclick="closeReviewModal()" class="flex-1 bg-gray-500 text-white px-6 py-2 rounded-lg hover:bg-gray-600 transition-colors">
                            Cancel
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div id="toast-container" class="fixed top-4 right-4 z-50 space-y-2"></div>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBOoMgr_8nkxwOF8ZjLqKqX8Z8Z8Z8Z8Z8Z8",
            authDomain: "life-app-12345.firebaseapp.com",
            projectId: "life-app-12345",
            storageBucket: "life-app-12345.appspot.com",
            messagingSenderId: "123456789012",
            appId: "1:123456789012:web:abcdef123456789012345"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        const ADMIN_EMAILS = [
            "tecnogasafamage@gmail.com",
            "lifeassistant60@gmail.com",
            "solodeveloperr.lk@gmail.com"
        ];

        let isAdminUser = false;
        let currentUser = null;

        // Global variables
        let allUsers = [];
        let filteredUsers = [];
        let currentPage = 1;
        const usersPerPage = 10;

        let allReviews = [];
        let filteredReviews = [];
        let currentReviewPage = 1;
        const reviewsPerPage = 10;

        // DOM elements
        let usersTableBody, searchInput, prevPageBtn, nextPageBtn, pageInfo;
        let loadingState, emptyState, userModal, userDetailContent;
        let mobileMenuButton, mobileMenuClose, mobileMenu;

        let reviewsTableBody, searchReviewsInput, filterRatingSelect;
        let reviewsPrevPageBtn, reviewsNextPageBtn, reviewsPageInfo;
        let reviewsLoadingState, reviewsEmptyState, reviewModal;

        function initializeDOMElements() {
            try {
                // User management elements
                usersTableBody = document.getElementById('users-table-body');
                searchInput = document.getElementById('search-users');
                prevPageBtn = document.getElementById('prev-page');
                nextPageBtn = document.getElementById('next-page');
                pageInfo = document.getElementById('page-info');
                loadingState = document.getElementById('loading-state');
                emptyState = document.getElementById('empty-state');
                userModal = document.getElementById('user-modal');
                userDetailContent = document.getElementById('user-detail-content');

                // Mobile menu elements
                mobileMenuButton = document.getElementById('mobile-menu-button');
                mobileMenuClose = document.getElementById('mobile-menu-close');
                mobileMenu = document.getElementById('mobile-menu');

                // Review management elements
                reviewsTableBody = document.getElementById('reviews-table-body');
                searchReviewsInput = document.getElementById('search-reviews');
                filterRatingSelect = document.getElementById('filter-rating');
                reviewsPrevPageBtn = document.getElementById('reviews-prev-page');
                reviewsNextPageBtn = document.getElementById('reviews-next-page');
                reviewsPageInfo = document.getElementById('reviews-page-info');
                reviewsLoadingState = document.getElementById('reviews-loading-state');
                reviewsEmptyState = document.getElementById('reviews-empty-state');
                reviewModal = document.getElementById('review-modal');

                console.log('[v0] DOM elements initialized successfully');
            } catch (error) {
                console.error('[v0] Error initializing DOM elements:', error);
            }
        }

        // Setup event listeners
        function setupEventListeners() {
            // User management event listeners
            if (searchInput) {
                searchInput.addEventListener('input', filterUsers);
            }
            if (prevPageBtn) {
                prevPageBtn.addEventListener('click', () => {
                    if (currentPage > 1) {
                        currentPage--;
                        displayUsers();
                    }
                });
            }
            if (nextPageBtn) {
                nextPageBtn.addEventListener('click', () => {
                    const totalPages = Math.ceil(filteredUsers.length / usersPerPage);
                    if (currentPage < totalPages) {
                        currentPage++;
                        displayUsers();
                    }
                });
            }

            // Mobile menu event listeners
            if (mobileMenuButton) {
                mobileMenuButton.addEventListener('click', () => {
                    mobileMenu.classList.add('active');
                });
            }
            if (mobileMenuClose) {
                mobileMenuClose.addEventListener('click', () => {
                    mobileMenu.classList.remove('active');
                });
            }
            if (mobileMenu) {
                mobileMenu.addEventListener('click', (e) => {
                    if (e.target === mobileMenu) {
                        mobileMenu.classList.remove('active');
                    }
                });
            }

            if (searchReviewsInput) {
                searchReviewsInput.addEventListener('input', filterReviews);
            }
            if (filterRatingSelect) {
                filterRatingSelect.addEventListener('change', filterReviews);
            }
            if (reviewsPrevPageBtn) {
                reviewsPrevPageBtn.addEventListener('click', () => {
                    if (currentReviewPage > 1) {
                        currentReviewPage--;
                        displayReviews();
                    }
                });
            }
            if (reviewsNextPageBtn) {
                reviewsNextPageBtn.addEventListener('click', () => {
                    const totalPages = Math.ceil(filteredReviews.length / reviewsPerPage);
                    if (currentReviewPage < totalPages) {
                        currentReviewPage++;
                        displayReviews();
                    }
                });
            }

            // Edit review form submission
            const editReviewForm = document.getElementById('edit-review-form');
            if (editReviewForm) {
                editReviewForm.addEventListener('submit', handleEditReview);
            }
        }

        // Initialize navigation
        function initializeNavigation() {
            const navButtons = document.querySelectorAll('.nav-btn');
            const mobileNavLinks = document.querySelectorAll('.mobile-nav-link');
            const sections = document.querySelectorAll('.section');

            function showSection(sectionId) {
                // Hide all sections
                sections.forEach(section => {
                    section.classList.remove('active');
                });

                // Show selected section
                const targetSection = document.getElementById(sectionId + '-section');
                if (targetSection) {
                    targetSection.classList.add('active');
                }

                // Update navigation buttons
                navButtons.forEach(btn => {
                    btn.classList.remove('active');
                });
                mobileNavLinks.forEach(link => {
                    link.classList.remove('active');
                });

                // Add active class to clicked button/link
                const activeNavBtn = document.querySelector(`.nav-btn[data-section="${sectionId}"]`);
                const activeMobileLink = document.querySelector(`.mobile-nav-link[data-section="${sectionId}"]`);
                
                if (activeNavBtn) activeNavBtn.classList.add('active');
                if (activeMobileLink) activeMobileLink.classList.add('active');

                // Close mobile menu
                if (mobileMenu) {
                    mobileMenu.classList.remove('active');
                }

                // Initialize charts if analytics section is shown
                if (sectionId === 'analytics') {
                    setTimeout(initializeCharts, 100);
                }

                if (sectionId === 'reviews') {
                    loadReviews();
                }
            }

            // Add click listeners to navigation buttons
            navButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    const sectionId = btn.getAttribute('data-section');
                    showSection(sectionId);
                });
            });

            mobileNavLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const sectionId = link.getAttribute('data-section');
                    showSection(sectionId);
                });
            });
        }

        function initializeAuth() {
            // Enable offline persistence
            db.enablePersistence().catch((err) => {
                console.log('[v0] Persistence error:', err);
            });

            auth.onAuthStateChanged(async (user) => {
                try {
                    if (user) {
                        currentUser = user;
                        isAdminUser = ADMIN_EMAILS.includes(user.email);
                        
                        if (isAdminUser) {
                            console.log('[v0] Admin user authenticated:', user.email);
                            
                            // Show loading state
                            showToast('Loading admin dashboard...', 'info');
                            
                            // Load data with error handling
                            try {
                                await Promise.all([
                                    loadUsers(),
                                    loadReviews()
                                ]);
                                initializeCharts();
                                showToast('Dashboard loaded successfully!', 'success');
                            } catch (error) {
                                console.error('[v0] Error loading dashboard data:', error);
                                showToast('Error loading dashboard data. Please refresh.', 'error');
                            }
                        } else {
                            console.log('[v0] Non-admin user detected:', user.email);
                            showToast('Access denied. Admin privileges required.', 'error');
                            setTimeout(() => {
                                auth.signOut().then(() => {
                                    window.location.href = 'login.html';
                                });
                            }, 3000);
                        }
                    } else {
                        console.log('[v0] No user authenticated, redirecting to login...');
                        // Clear any cached data
                        allUsers = [];
                        filteredUsers = [];
                        allReviews = [];
                        filteredReviews = [];
                        
                        // Redirect to login
                        setTimeout(() => {
                            window.location.href = 'login.html';
                        }, 1000);
                    }
                } catch (error) {
                    console.error('[v0] Authentication error:', error);
                    showToast('Authentication error. Please try again.', 'error');
                    setTimeout(() => {
                        window.location.href = 'login.html';
                    }, 2000);
                }
            });
        }

        async function loadUsers() {
            if (!usersLoadingState || !usersTableBody) {
                console.error('[v0] Users DOM elements not found');
                return;
            }

            try {
                usersLoadingState.style.display = 'block';
                usersTableBody.innerHTML = '';

                const usersSnapshot = await db.collection('users').orderBy('createdAt', 'desc').get();
                allUsers = [];

                if (usersSnapshot.empty) {
                    console.log('[v0] No users found in database');
                    usersTableBody.innerHTML = '<tr><td colspan="6" class="text-center py-4 text-gray-500">No users found</td></tr>';
                    return;
                }

                usersSnapshot.forEach((doc) => {
                    const userData = doc.data();
                    allUsers.push({
                        id: doc.id,
                        ...userData,
                        createdAt: userData.createdAt?.toDate() || new Date()
                    });
                });

                filteredUsers = [...allUsers];
                displayUsers();
                updateUserStats();
                console.log('[v0] Users loaded successfully:', allUsers.length);

            } catch (error) {
                console.error('[v0] Error loading users:', error);
                showToast('Error loading users: ' + error.message, 'error');
                usersTableBody.innerHTML = '<tr><td colspan="6" class="text-center py-4 text-red-500">Error loading users</td></tr>';
            } finally {
                if (usersLoadingState) {
                    usersLoadingState.style.display = 'none';
                }
            }
        }

        async function loadReviews() {
            if (!reviewsLoadingState || !reviewsTableBody) {
                console.error('[v0] Reviews DOM elements not found');
                return;
            }

            try {
                reviewsLoadingState.style.display = 'block';
                reviewsTableBody.innerHTML = '';

                const reviewsSnapshot = await db.collection('reviews').orderBy('createdAt', 'desc').get();
                allReviews = [];

                if (reviewsSnapshot.empty) {
                    console.log('[v0] No reviews found in database');
                    reviewsTableBody.innerHTML = '<tr><td colspan="6" class="text-center py-4 text-gray-500">No reviews found</td></tr>';
                    return;
                }

                // Load user data for each review
                const userPromises = [];
                const reviewsData = [];

                reviewsSnapshot.forEach((doc) => {
                    const reviewData = doc.data();
                    reviewsData.push({
                        id: doc.id,
                        ...reviewData,
                        createdAt: reviewData.createdAt?.toDate() || new Date()
                    });
                    
                    if (reviewData.userId) {
                        userPromises.push(
                            db.collection('users').doc(reviewData.userId).get()
                        );
                    }
                });

                // Wait for all user data to load
                const userSnapshots = await Promise.all(userPromises);
                const usersMap = {};
                
                userSnapshots.forEach((userDoc, index) => {
                    if (userDoc.exists) {
                        usersMap[reviewsData[index].userId] = userDoc.data();
                    }
                });

                // Combine review and user data
                allReviews = reviewsData.map(review => ({
                    ...review,
                    userName: usersMap[review.userId]?.name || 'Unknown User',
                    userEmail: usersMap[review.userId]?.email || 'No email'
                }));

                filteredReviews = [...allReviews];
                displayReviews();
                updateReviewStats();
                console.log('[v0] Reviews loaded successfully:', allReviews.length);

            } catch (error) {
                console.error('[v0] Error loading reviews:', error);
                showToast('Error loading reviews: ' + error.message, 'error');
                reviewsTableBody.innerHTML = '<tr><td colspan="6" class="text-center py-4 text-red-500">Error loading reviews</td></tr>';
            } finally {
                if (reviewsLoadingState) {
                    reviewsLoadingState.style.display = 'none';
                }
            }
        }

        function initializeCharts() {
            try {
                if (typeof Chart === 'undefined') {
                    console.error('[v0] Chart.js not loaded');
                    showToast('Chart library not loaded. Please refresh the page.', 'error');
                    return;
                }

                // Initialize user activity chart
                const userActivityCtx = document.getElementById('userActivityChart');
                if (userActivityCtx && allUsers.length > 0) {
                    const activeUsers = allUsers.filter(user => {
                        const lastActive = user.lastActive?.toDate() || user.createdAt;
                        const daysSinceActive = (new Date() - lastActive) / (1000 * 60 * 60 * 24);
                        return daysSinceActive <= 7;
                    }).length;

                    const inactiveUsers = allUsers.length - activeUsers;

                    new Chart(userActivityCtx, {
                        type: 'pie',
                        data: {
                            labels: ['Active Users', 'Inactive Users'],
                            datasets: [{
                                data: [activeUsers, inactiveUsers],
                                backgroundColor: ['#10B981', '#EF4444'],
                                borderWidth: 0
                            }]
                        },
                        options: {
                            responsive: true,
                            plugins: {
                                legend: {
                                    position: 'bottom',
                                    labels: { color: '#fff' }
                                }
                            }
                        }
                    });
                }

                // Initialize reviews chart
                const reviewsCtx = document.getElementById('reviewsChart');
                if (reviewsCtx && allReviews.length > 0) {
                    const ratingCounts = [0, 0, 0, 0, 0];
                    allReviews.forEach(review => {
                        if (review.rating >= 1 && review.rating <= 5) {
                            ratingCounts[review.rating - 1]++;
                        }
                    });

                    new Chart(reviewsCtx, {
                        type: 'bar',
                        data: {
                            labels: ['1 Star', '2 Stars', '3 Stars', '4 Stars', '5 Stars'],
                            datasets: [{
                                label: 'Number of Reviews',
                                data: ratingCounts,
                                backgroundColor: '#8B5CF6',
                                borderRadius: 8
                            }]
                        },
                        options: {
                            responsive: true,
                            plugins: {
                                legend: { display: false }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    ticks: { color: '#fff' },
                                    grid: { color: 'rgba(255,255,255,0.1)' }
                                },
                                x: {
                                    ticks: { color: '#fff' },
                                    grid: { color: 'rgba(255,255,255,0.1)' }
                                }
                            }
                        }
                    });
                }

                console.log('[v0] Charts initialized successfully');
            } catch (error) {
                console.error('[v0] Error initializing charts:', error);
                showToast('Error loading charts: ' + error.message, 'error');
            }
        }

        // Update statistics
        function updateStats() {
            const totalUsers = allUsers.length;
            const activeUsers = allUsers.filter(user => user.isActive).length;
            const completeProfiles = allUsers.filter(user => user.profileComplete).length;

            document.getElementById('total-users').textContent = totalUsers;
            document.getElementById('active-users').textContent = activeUsers;
            document.getElementById('complete-profiles').textContent = completeProfiles;
        }

        function initializeApp() {
            console.log('[v0] Initializing admin panel...');
            
            // Initialize DOM elements first
            initializeDOMElements();
            
            // Setup event listeners
            setupEventListeners();
            
            // Initialize navigation
            initializeNavigation();
            
            // Initialize authentication (this will handle data loading)
            initializeAuth();
        }

        document.addEventListener('DOMContentLoaded', () => {
            initializeApp();
        });
    </script>
</body>
</html>
